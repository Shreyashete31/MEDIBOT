/**
 * Dark Mode Utility for HealthHub
 * Provides consistent dark mode functionality across all pages
 */
class DarkModeManager{constructor(){this.storageKey='darkMode';this.isDarkMode=!1;this.observer=null;this.styleId='dark-mode-styles';this.init()}safeGet(e){try{const t=localStorage.getItem(e);return null===t?null:t}catch{return null}}safeSet(e,t){try{return localStorage.setItem(e,t),!0}catch{return!1}}init(){const e=this.safeGet(this.storageKey),t=typeof window<'u'&&window.matchMedia?window.matchMedia('(prefers-color-scheme: dark)').matches:!1;this.isDarkMode=e!==null?e==='true':t,this.observer=new MutationObserver(()=>{try{this.updateToggleButtons()}catch{}});const o=()=>{this.applyDarkMode(),this.applyAppSettings(),this.updateToggleButtons(),document&&document.body&&(()=>{try{this.observer.observe(document.body,{childList:!0,subtree:!0})}catch{}})()};document&&document.readyState==='loading'?document.addEventListener('DOMContentLoaded',o,{once:!0}):o(),typeof window<'u'&&window.matchMedia&&(()=>{const e=window.matchMedia('(prefers-color-scheme: dark)'),t=e=>{this.safeGet(this.storageKey)===null&&(this.isDarkMode=!!e.matches,this.applyDarkMode(),this.updateToggleButtons())};e.addEventListener?t(e):e.addListener&&e.addListener(t)})(),this.injectStyles()}toggle(){this.isDarkMode=!this.isDarkMode,this.safeSet(this.storageKey,this.isDarkMode.toString()),this.applyDarkMode(),this.updateToggleButtons()}applyDarkMode(){const e=document.documentElement,t=document.body;if(this.updateThemeColor(),!e||!t){if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>this.applyDarkMode(),{once:!0})}return}this.isDarkMode?(e.classList.add('dark-mode'),t.classList.add('dark-mode')):(e.classList.remove('dark-mode'),t.classList.remove('dark-mode'))}applyAppSettings(){if(typeof document>'u')return;let e={};try{e=JSON.parse(localStorage.getItem('appSettings')||'{}')}catch{}const t=document.documentElement,o=document.body;if(!t||!o)return;e.fontSize&&(t.style.fontSize=String(e.fontSize)+'px'),e.highContrast?o.classList.add('high-contrast'):o.classList.remove('high-contrast'),e.screenReader?o.classList.add('screen-reader-optimized'):o.classList.remove('screen-reader-optimized');const s=e.animationSpeed||'normal';s==='none'?o.classList.add('reduce-motion'):o.classList.remove('reduce-motion');try{const e=window.matchMedia&&window.matchMedia('(prefers-reduced-motion: reduce)').matches;s==='normal'&&e&&o.classList.add('reduce-motion')}catch{}let i='1';s==='slow'?i='1.5':s==='fast'&&(i='0.75');try{t.style.setProperty('--animation-factor',i)}catch{}}updateThemeColor(){if(typeof document>'u')return;let e=document.querySelector('meta[name="theme-color"]');if(!e)try{e=document.createElement('meta'),e.setAttribute('name','theme-color'),document.head&&document.head.appendChild(e)}catch{return}e&&(e.content=this.isDarkMode?'#1a1a1a':'#009688')}updateToggleButtons(){if(typeof document>'u')return;const e=document.querySelectorAll('.dark-mode-toggle');e.forEach(e=>{try{e.hasAttribute('role')||e.setAttribute('role','switch'),e.setAttribute('tabindex',e.getAttribute('tabindex')||'0');const t=this.isDarkMode;e.setAttribute('aria-checked',t?'true':'false');const o=e.querySelector('i');o&&(o.classList.remove('fa-moon','fa-sun','fas','far'),t?(o.classList.add('fas','fa-sun'),e.title='Switch to Light Mode'):(o.classList.add('fas','fa-moon'),e.title='Switch to Dark Mode'))}catch{}})}getState(){return this.isDarkMode}setState(e){this.isDarkMode=!!e,this.safeSet(this.storageKey,this.isDarkMode.toString()),this.applyDarkMode(),this.updateToggleButtons()}injectStyles(){if(!document.head||document.getElementById('dark-mode-styles'))return;const e=`
      .dark-mode-toggle { background: rgba(255,255,255,0.1); border: none; color: white; padding: 0.5rem; border-radius: 50%; cursor: pointer; font-size: 1.1rem; display:flex; align-items:center; justify-content:center; width:40px;height:40px; transition:transform .12s ease; }
      .dark-mode-toggle:hover { transform:scale(1.05); }
      :root { --animation-factor: 1; }
      .reduce-motion * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
      .dark-mode { --text-primary:#e7e9ea; --text-secondary:#b0b8c0; --background:#0f1215; --surface:#1a1f24; --border-color:#2a333a; --primary-color:#66c1ff; --primary-dark:#4aa7e6; --secondary-color:#85d39a; --accent-color:#ff9b80; --success-color:#4caf50; --error-color:#f44336; --warning-color:#ffb74d; --shadow:0 2px 12px rgba(0,0,0,0.6); --shadow-hover:0 4px 24px rgba(0,0,0,0.8); --gradient-primary:linear-gradient(135deg,#1f7bb6,#165f8c); --gradient-secondary:linear-gradient(135deg,#2f7a4a,#25663e); }
      body.dark-mode { background: linear-gradient(135deg,#0b0e11 0%, #101413 100%) !important; }
      .dark-mode .app-header { box-shadow: var(--shadow-hover); }
      .dark-mode .card, .dark-mode .settings-section, .dark-mode .action-card, .dark-mode .search-section { background: var(--surface); color: var(--text-primary); }
      .high-contrast.dark-mode { --border-color:#90caf9; }`;const t=document.createElement('style');t.id='dark-mode-styles',t.type='text/css',t.appendChild(document.createTextNode(e)),document.head.appendChild(t)}}
if(typeof window<'u'&&!window.darkModeManager)window.darkModeManager=new DarkModeManager;typeof window<'u'&&(window.toggleDarkMode=()=>{window.darkModeManager&&window.darkModeManager.toggle()},window.setDarkMode=e=>{window.darkModeManager&&window.darkModeManager.setState(e)},window.getDarkMode=()=>window.darkModeManager?window.darkModeManager.getState():!1);
function navigateTo(e){if(!e||typeof window>'u')return;if(e.startsWith('#')){window.location.hash=e;return}const t=/^https?:\/\//i.test(e);try{t?window.location.href=e:(window.location.href=e.indexOf('.')===-1&&!e.endsWith('/')?`${e}.html`:e)}catch{}}
document.addEventListener('click',function(e){try{let t=e.target;for(;t&&t!==document;){if(t.matches&&(t.matches('[data-page]')||t.matches('.nav-link')||t.tagName==='A'&&t.getAttribute('href'))){const o=t.getAttribute('data-page')||t.getAttribute('href');if(o){e.preventDefault(),navigateTo(o)}break}t=t.parentElement}}catch{}});
document.addEventListener('keydown',function(e){try{if(e.altKey&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){const t=String(e.key||'').toLowerCase();t==='s'?(e.preventDefault(),navigateTo('settings')):t==='a'?(e.preventDefault(),navigateTo('about')):t==='h'?(e.preventDefault(),navigateTo('3 home')):t==='p'&&(e.preventDefault(),navigateTo('profile'))}if(e.key==='/'&&!e.altKey&&!e.ctrlKey&&!e.metaKey){const t=document.activeElement,o=t&&(t.tagName==='INPUT'||t.tagName==='TEXTAREA'||t.isContentEditable);if(!o){const t=document.querySelector('input[placeholder*="search" i], .search-container input, #firstAidSearch');t&&(e.preventDefault(),t.focus(),(()=>{try{t.select()}catch{}})())}}}catch{}});