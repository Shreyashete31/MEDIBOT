<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>First Aid Guide - HealthHub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #3e61cc;
      --primary-dark: #2c4fb3;
      --secondary-color: #58b395;
      --accent-color: #d66f84;
      --warning-color: #c9993b;
      --danger-color: #a83e3e;
      --text-primary: #1f2a37;
      --text-secondary: #5c6b7a;
      --background: #d5e0ff;
      --surface: #ffffff;
      --border-color: #c0ccee;
      --shadow: 0 12px 30px rgba(62, 97, 204, 0.2);
      --shadow-hover: 0 18px 40px rgba(44, 79, 179, 0.28);
      --gradient-primary: linear-gradient(135deg, #86a6f2 0%, #cd94f0 100%);
      --gradient-danger: linear-gradient(135deg, #e37f7f, #a83e3e);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #d0dcff 0%, #ffc6ce 100%);
      color: var(--text-primary);
      min-height: 100vh;
    }

    /* Header */
    .app-header {
      background: var(--gradient-danger);
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-hover);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .back-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 0.5rem;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      transition: background 0.3s ease;
    }

    .back-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    .header-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    .emergency-btn {
      background: rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.3);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .emergency-btn:hover {
      background: rgba(255,255,255,0.3);
      border-color: rgba(255,255,255,0.5);
    }

    /* Navigation */
    nav {
      background: var(--surface);
      padding: 0.75rem 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    nav a {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      background: var(--background);
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    nav a:hover, nav a.active {
      background: var(--primary-color);
      color: white;
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    /* Main Container */
    .container {
      padding: 2rem 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Emergency Alert */
    .emergency-alert {
      background: var(--gradient-danger);
      color: white;
      padding: 1.5rem;
      border-radius: 16px;
      margin-bottom: 2rem;
      text-align: center;
      box-shadow: var(--shadow-hover);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    .emergency-alert h2 {
      margin: 0 0 1rem;
      font-size: 1.5rem;
    }

    .emergency-number {
      font-size: 2rem;
      font-weight: 700;
      margin: 0.5rem 0;
    }

    /* Search Section */
    .search-section {
      background: var(--surface);
      padding: 1.5rem;
      border-radius: 16px;
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
    }

    .search-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0 0 1rem;
      color: var(--text-primary);
    }

    .search-input {
      position: relative;
      width: 100%;
    }

    .search-input input {
      width: 100%;
      padding: 1rem 1rem 1rem 3rem;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      font-size: 1rem;
      background: var(--surface);
      transition: all 0.3s ease;
      outline: none;
    }

    .search-input input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0,150,136,0.1);
    }

    .search-input i {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
    }

    /* Categories */
    .categories-section {
      margin-bottom: 2rem;
    }

    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .category-card {
      background: var(--surface);
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .category-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
      border-color: var(--primary-color);
    }

    .category-card.active {
      border-color: var(--primary-color);
      box-shadow: var(--shadow-hover);
      background: linear-gradient(135deg, rgba(111,156,250,0.08), rgba(247,196,255,0.08));
    }

    .category-card.emergency {
      background: var(--gradient-danger);
      color: white;
    }

    .category-card.emergency:hover {
      border-color: rgba(255,255,255,0.5);
    }

    .category-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .category-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0 0 0.5rem;
    }

    .category-desc {
      font-size: 0.9rem;
      opacity: 0.8;
      margin: 0;
    }

    .category-status {
      text-align: center;
      margin: 1rem 0 2rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* First Aid Cards */
    .first-aid-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 1.5rem;
    }

    .first-aid-card {
      background: var(--surface);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .first-aid-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
      border-color: var(--primary-color);
    }

    .first-aid-card.emergency {
      border-left: 4px solid var(--danger-color);
    }

    .card-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .card-category {
      display: inline-block;
      background: var(--gradient-primary);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .card-category.emergency {
      background: var(--gradient-danger);
    }

    .card-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0 0 0.5rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-description {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.5;
      margin: 0;
    }

    .card-content {
      padding: 1.5rem;
    }

    .steps-section {
      margin-bottom: 1.5rem;
    }

    .steps-title {
      font-size: 1rem;
      font-weight: 600;
      margin: 0 0 1rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .steps-list {
      counter-reset: step-counter;
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .steps-list li {
      counter-increment: step-counter;
      padding: 0.75rem 0 0.75rem 3rem;
      position: relative;
      line-height: 1.5;
      border-bottom: 1px solid var(--border-color);
    }

    .steps-list li:last-child {
      border-bottom: none;
    }

    .steps-list li:before {
      content: counter(step-counter);
      position: absolute;
      left: 0;
      top: 0.75rem;
      background: var(--primary-color);
      color: white;
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .warning-section {
      background: rgba(255, 193, 7, 0.1);
      border-left: 4px solid var(--warning-color);
      padding: 1rem;
      border-radius: 0 8px 8px 0;
      margin: 1rem 0;
    }

    .warning-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--warning-color);
      margin: 0 0 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .warning-text {
      font-size: 0.85rem;
      color: var(--text-secondary);
      line-height: 1.4;
      margin: 0;
    }

    .card-actions {
      padding: 1.5rem;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 1rem;
    }

    .action-btn {
      flex: 1;
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .action-btn.emergency {
      background: var(--gradient-danger);
    }

    .action-btn.secondary {
      background: transparent;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }

    .action-btn.secondary:hover {
      background: var(--primary-color);
      color: white;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-secondary);
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 1.2rem;
      margin: 0 0 0.5rem;
      color: var(--text-primary);
    }

    .empty-state p {
      margin: 0;
      font-size: 0.9rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }

      .first-aid-grid {
        grid-template-columns: 1fr;
      }

      .categories-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .card-actions {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .app-header {
        padding: 1rem;
      }

      .header-title {
        font-size: 1.2rem;
      }

      .emergency-number {
        font-size: 1.5rem;
      }

      .categories-grid {
        grid-template-columns: 1fr;
      }
    }

    /* No dark theme per design requirements */
  </style>
</head>
<body>
  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <button class="back-btn" onclick="goBack()">
        <i class="fas fa-arrow-left"></i>
      </button>
      <h1 class="header-title">First Aid Guide</h1>
    </div>
    
    <button class="emergency-btn" onclick="callEmergency()">
      <i class="fas fa-phone"></i>
      Emergency: 112
    </button>
  </header>

  <!-- Navigation -->
  <nav>
    <a href="3 home.html">Home</a>
    <a href="remedies_enhanced.html">Remedies</a>
    <a href="firstaid.html" class="active">First Aid</a>
    <a href="suggestions.html">Suggestions</a>
    <a href="emergency_enhanced.html">Emergency</a>
  </nav>

  <!-- Main Container -->
  <main class="container">
    <!-- Emergency Alert -->
    <div class="emergency-alert">
      <h2><i class="fas fa-exclamation-triangle"></i> Emergency Situation?</h2>
      <p>If this is a life-threatening emergency, call immediately:</p>
      <div class="emergency-number">112</div>
      <p>Or your local emergency number</p>
    </div>

    <!-- Search Section -->
    <section class="search-section">
      <h2 class="search-title">Search First Aid Instructions</h2>
      <div class="search-input">
        <i class="fas fa-search"></i>
        <input type="text" id="firstAidSearch" placeholder="Search for first aid procedures (e.g., burns, cuts, choking)..." />
      </div>
    </section>

    <!-- Categories -->
    <section class="categories-section">
      <h2 class="search-title">Emergency Categories</h2>
      <div class="categories-grid">
        <div class="category-card emergency" data-category="emergency" onclick="filterByCategory('emergency')">
          <div class="category-icon">üö®</div>
          <div class="category-title">Emergency</div>
          <div class="category-desc">Life-threatening situations</div>
        </div>
        
        <div class="category-card" data-category="wounds" onclick="filterByCategory('wounds')">
          <div class="category-icon">ü©π</div>
          <div class="category-title">Wounds & Injuries</div>
          <div class="category-desc">Cuts, burns, sprains</div>
        </div>
        
        <div class="category-card" data-category="medical" onclick="filterByCategory('medical')">
          <div class="category-icon">ü©∫</div>
          <div class="category-title">Medical Emergencies</div>
          <div class="category-desc">Heart attack, stroke, seizures</div>
        </div>
        
        <div class="category-card" data-category="environmental" onclick="filterByCategory('environmental')">
          <div class="category-icon">üå°Ô∏è</div>
          <div class="category-title">Environmental</div>
          <div class="category-desc">Heat stroke, hypothermia</div>
        </div>
        
        <div class="category-card" data-category="poisoning" onclick="filterByCategory('poisoning')">
          <div class="category-icon">‚ò†Ô∏è</div>
          <div class="category-title">Poisoning</div>
          <div class="category-desc">Chemical exposure, food poisoning</div>
        </div>
        
        <div class="category-card" data-category="respiratory" onclick="filterByCategory('respiratory')">
          <div class="category-icon">ü´Å</div>
          <div class="category-title">Respiratory</div>
          <div class="category-desc">Choking, breathing problems</div>
        </div>
      </div>
      <div id="categoryStatus" class="category-status">Showing all emergency guides</div>
    </section>

    <!-- First Aid Instructions -->
    <div class="first-aid-grid" id="firstAidGrid">
      <!-- First aid instructions will be populated by JavaScript -->
    </div>
  </main>

  <script src="api-config.js"></script>
  <script>
    // Ripple effect for interactive elements
    document.addEventListener('click', function(e) {
      const target = e.target.closest('.emergency-btn, .category-card, .action-btn, .back-btn');
      if (!target) return;
      const rect = target.getBoundingClientRect();
      const ripple = document.createElement('span');
      const size = Math.max(rect.width, rect.height);
      ripple.style.position = 'absolute';
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
      ripple.style.top = (e.clientY - rect.top - size/2) + 'px';
      ripple.style.background = 'rgba(255,255,255,0.35)';
      ripple.style.borderRadius = '50%';
      ripple.style.pointerEvents = 'none';
      ripple.style.transform = 'scale(0)';
      ripple.style.transition = 'transform 400ms ease, opacity 600ms ease';
      ripple.className = 'ripple';
      target.style.position = 'relative';
      target.appendChild(ripple);
      requestAnimationFrame(() => {
        ripple.style.transform = 'scale(2)';
        ripple.style.opacity = '0';
      });
      setTimeout(() => ripple.remove(), 650);
    });
    // Global variables
    let currentUser = null;
    let allFirstAid = [];
    let filteredFirstAid = [];
    let activeCategory = 'all';

    const categoryFilters = {
      all: () => true,
      emergency: (instruction) => instruction.emergency || includesText(instruction.category, ['emergency']) || includesText(instruction.severity, ['critical', 'high']),
      wounds: (instruction) => includesText(`${instruction.title} ${instruction.description}`, ['wound', 'cut', 'bleed', 'burn', 'sprain']),
      medical: (instruction) => includesText(instruction.category, ['medical']) || includesText(instruction.title, ['heart', 'stroke', 'seizure']),
      environmental: (instruction) => includesText(instruction.category, ['environment']) || includesText(instruction.title, ['heat', 'hypothermia']),
      poisoning: (instruction) => includesText(instruction.category, ['poison']) || includesText(instruction.title, ['poison', 'toxin', 'bite']),
      respiratory: (instruction) => includesText(instruction.category, ['respiratory']) || includesText(instruction.title, ['choking', 'breath', 'asthma'])
    };

    function includesText(text = '', keywords = []) {
      const haystack = String(text).toLowerCase();
      return keywords.some(keyword => haystack.includes(keyword));
    }

    // Fallback: load from backend if available, else use embedded dataset
    const firstAidData = [
      {
        id: "burns",
        title: "Burns Treatment",
        category: "wounds",
        emergency: false,
        description: "First aid for thermal, chemical, or electrical burns",
        steps: [
          "Remove the person from the source of the burn",
          "Cool the burn with cool running water for 10-15 minutes",
          "Remove jewelry or tight clothing near the burn area",
          "Cover the burn with a sterile, non-adhesive bandage",
          "Do not apply ice, butter, or ointments to severe burns",
          "Seek medical attention for burns larger than 3 inches"
        ],
        warnings: "Never break blisters or remove clothing stuck to the burn. For chemical burns, call poison control immediately.",
        severity: "medium"
      },
      {
        id: "choking",
        title: "Choking (Heimlich Maneuver)",
        category: "respiratory",
        emergency: true,
        description: "Emergency procedure to clear airway obstruction",
        steps: [
          "Ask 'Are you choking?' - if they can speak, encourage coughing",
          "Stand behind the person and wrap your arms around their waist",
          "Make a fist with one hand and place it above the navel",
          "Grasp your fist with your other hand",
          "Perform quick upward thrusts until the object is expelled",
          "If unconscious, begin CPR and call 911 immediately"
        ],
        warnings: "For pregnant women or obese individuals, place hands higher on the chest. For infants, use back blows and chest thrusts.",
        severity: "high"
      },
      {
        id: "heart-attack",
        title: "Heart Attack",
        category: "medical",
        emergency: true,
        description: "Emergency response for suspected heart attack",
        steps: [
          "Call 911 immediately - time is critical",
          "Have the person sit down and rest comfortably",
          "Loosen tight clothing around neck and waist",
          "If prescribed, help them take their nitroglycerin",
          "Give aspirin (325mg) if not allergic and not contraindicated",
          "Stay with the person and monitor their condition",
          "Be prepared to perform CPR if they become unconscious"
        ],
        warnings: "Do not delay calling 911. Every minute counts. Do not drive them to the hospital yourself.",
        severity: "critical"
      },
      {
        id: "cuts-wounds",
        title: "Cuts and Wounds",
        category: "wounds",
        emergency: false,
        description: "First aid for minor cuts and bleeding wounds",
        steps: [
          "Wash your hands thoroughly before providing care",
          "Apply direct pressure with a clean cloth or bandage",
          "Elevate the injured area above heart level if possible",
          "Clean the wound with cool running water",
          "Apply antibiotic ointment if available",
          "Cover with a sterile bandage or gauze",
          "Change the dressing daily and watch for signs of infection"
        ],
        warnings: "Seek immediate medical attention if bleeding doesn't stop, the wound is deep, or if there are signs of infection.",
        severity: "low"
      },
      {
        id: "stroke",
        title: "Stroke (FAST)",
        category: "medical",
        emergency: true,
        description: "Recognizing and responding to stroke symptoms",
        steps: [
          "Remember FAST: Face, Arms, Speech, Time",
          "Face: Ask them to smile - does one side droop?",
          "Arms: Ask them to raise both arms - does one drift down?",
          "Speech: Ask them to repeat a simple sentence - is speech slurred?",
          "Time: If any of these signs are present, call 911 immediately",
          "Note the time symptoms first appeared",
          "Keep the person calm and comfortable while waiting for help"
        ],
        warnings: "Time is critical for stroke treatment. The sooner treatment begins, the better the outcome. Do not give aspirin unless directed by medical personnel.",
        severity: "critical"
      },
      {
        id: "heat-stroke",
        title: "Heat Stroke",
        category: "environmental",
        emergency: true,
        description: "Emergency treatment for heat-related illness",
        steps: [
          "Call 911 immediately - heat stroke is a medical emergency",
          "Move the person to a cool, shaded area",
          "Remove excess clothing and apply cool water to skin",
          "Use ice packs on neck, armpits, and groin areas",
          "Fan the person to increase cooling",
          "Do not give them anything to drink if they're unconscious",
          "Monitor their temperature if possible"
        ],
        warnings: "Heat stroke can be fatal. Do not delay calling 911. Do not give alcohol or caffeine to cool down.",
        severity: "high"
      }
      ,
      {
        id: "sprain",
        title: "Sprains & Strains",
        category: "wounds",
        emergency: false,
        description: "First aid for twisted or overstretched ligaments and muscles",
        steps: [
          "Rest the injured area and avoid using it",
          "Apply ice packs for 15-20 minutes every 2-3 hours",
          "Compress with an elastic bandage (not too tight)",
          "Elevate the limb above heart level",
          "Seek medical attention if severe pain or swelling occurs"
        ],
        warnings: "Do not apply heat in the first 48 hours. Do not try to straighten or move a severely injured joint.",
        severity: "low"
      },
      {
        id: "nosebleed",
        title: "Nosebleed",
        category: "medical",
        emergency: false,
        description: "How to stop a bleeding nose",
        steps: [
          "Sit upright and lean forward slightly",
          "Pinch the soft part of the nose for 10-15 minutes",
          "Breathe through your mouth",
          "Apply a cold compress to the nose bridge",
          "Avoid blowing your nose for several hours"
        ],
        warnings: "Seek medical help if bleeding lasts more than 20 minutes or after an injury.",
        severity: "low"
      },
      {
        id: "seizure",
        title: "Seizure (Convulsion)",
        category: "medical",
        emergency: true,
        description: "What to do if someone is having a seizure",
        steps: [
          "Stay calm and protect the person from injury",
          "Move objects away and cushion their head",
          "Do not restrain movements or put anything in their mouth",
          "Time the seizure",
          "After it ends, place them in the recovery position",
          "Call 911 if it lasts more than 5 minutes or if they do not regain consciousness"
        ],
        warnings: "Never put anything in the person's mouth. Seek emergency help for first-time seizures or if injured.",
        severity: "high"
      },
      {
        id: "allergic-reaction",
        title: "Severe Allergic Reaction (Anaphylaxis)",
        category: "medical",
        emergency: true,
        description: "How to respond to life-threatening allergic reactions",
        steps: [
          "Call 911 immediately",
          "Help the person use their epinephrine auto-injector if available",
          "Have them lie down and elevate their legs",
          "Loosen tight clothing",
          "If not breathing, begin CPR"
        ],
        warnings: "Anaphylaxis can be fatal. Do not wait to see if symptoms improve.",
        severity: "critical"
      },
      {
        id: "fainting",
        title: "Fainting (Syncope)",
        category: "medical",
        emergency: false,
        description: "First aid for someone who has fainted",
        steps: [
          "Lay the person flat on their back",
          "Elevate their legs above heart level",
          "Loosen tight clothing",
          "Check for breathing and responsiveness",
          "If unresponsive for more than 1 minute, call 911"
        ],
        warnings: "Do not let them get up too quickly. Seek help if they do not regain consciousness promptly.",
        severity: "medium"
      },
      {
        id: "fracture",
        title: "Fractures (Broken Bones)",
        category: "wounds",
        emergency: true,
        description: "How to provide first aid for suspected broken bones",
        steps: [
          "Keep the person still and calm",
          "Immobilize the injured area with a splint or sling",
          "Apply ice packs to reduce swelling",
          "Do not try to realign the bone",
          "Call 911 for open fractures or if the person is in severe pain"
        ],
        warnings: "Do not move the person unless necessary. Open fractures require immediate medical attention.",
        severity: "high"
      },
      {
        id: "hypothermia",
        title: "Hypothermia",
        category: "environmental",
        emergency: true,
        description: "First aid for dangerously low body temperature",
        steps: [
          "Move the person to a warm, dry place",
          "Remove wet clothing and cover with blankets",
          "Warm the center of the body first (chest, neck, head, groin)",
          "Give warm, non-alcoholic, non-caffeinated drinks if conscious",
          "Call 911 immediately"
        ],
        warnings: "Do not use hot water or direct heat. Do not massage or rub the person.",
        severity: "high"
      },
      {
        id: "asthma-attack",
        title: "Asthma Attack",
        category: "respiratory",
        emergency: true,
        description: "What to do during an asthma attack",
        steps: [
          "Help the person sit upright and stay calm",
          "Assist with their inhaler (2 puffs every 4 minutes if needed)",
          "Loosen tight clothing",
          "Call 911 if symptoms do not improve or worsen",
          "Monitor breathing until help arrives"
        ],
        warnings: "Do not leave the person alone. Severe attacks can be life-threatening.",
        severity: "high"
      },
      {
        id: "poisoning",
        title: "Poisoning (Ingestion)",
        category: "poisoning",
        emergency: true,
        description: "First aid for swallowed poisons",
        steps: [
          "Call poison control or 911 immediately",
          "Do not induce vomiting unless instructed",
          "Check for breathing and responsiveness",
          "If unconscious, place in recovery position and monitor breathing",
          "Provide information about the substance if possible"
        ],
        warnings: "Do not give anything by mouth unless told by a professional.",
        severity: "critical"
      },
      {
        id: "drowning",
        title: "Drowning",
        category: "emergency",
        emergency: true,
        description: "How to respond to a drowning emergency",
        steps: [
          "Call 911 immediately",
          "Remove the person from the water if safe to do so",
          "Check for breathing and pulse",
          "Begin CPR if not breathing",
          "Keep the person warm and monitor until help arrives"
        ],
        warnings: "Do not put yourself at risk. Always call for help first.",
        severity: "critical"
      },
      {
        id: "electric-shock",
        title: "Electric Shock",
        category: "emergency",
        emergency: true,
        description: "First aid for electrical injuries",
        steps: [
          "Turn off the source of electricity if possible",
          "Do not touch the person until power is off",
          "Call 911 immediately",
          "Check for breathing and pulse, begin CPR if needed",
          "Treat burns and cover with sterile gauze"
        ],
        warnings: "High voltage shocks can cause internal injuries. Always seek medical attention.",
        severity: "critical"
      },
      {
        id: "bee-sting",
        title: "Bee Sting",
        category: "poisoning",
        emergency: false,
        description: "First aid for bee or wasp stings",
        steps: [
          "Remove the stinger by scraping with a fingernail or card",
          "Wash the area with soap and water",
          "Apply a cold pack to reduce swelling",
          "Take antihistamines if needed",
          "Seek medical help if signs of allergic reaction appear"
        ],
        warnings: "Watch for difficulty breathing, swelling of face or throat, or dizziness.",
        severity: "medium"
      }
    ];

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      initializeUser();
      initializeFirstAid();
      initializeSearch();
    });

    // User initialization
    function initializeUser() {
      currentUser = localStorage.getItem('loggedInUser');
    }

    // Merge helper for First Aid page
    function mergeFirstAid(baseArray, verifiedArray) {
      const getKey = (item) => (item.id ? String(item.id).toLowerCase() : (item.title || '').toLowerCase());
      const map = new Map();
      (baseArray || []).forEach((item) => map.set(getKey(item), item));
      (verifiedArray || []).forEach((item) => {
        const key = getKey(item);
        if (!map.has(key)) {
          map.set(key, item);
        } else {
          const existing = map.get(key);
          map.set(key, {
            ...existing,
            ...item,
            keywords: Array.from(new Set([...(existing.keywords || []), ...(item.keywords || [])]))
          });
        }
      });
      return Array.from(map.values());
    }
    
    // Initialize first aid data
    async function initializeFirstAid() {
      try {
        const data = await apiCall('/first-aid?limit=50');
        if (data.success) {
          allFirstAid = data.data.map(item => ({
            id: item.id,
            title: item.title,
            category: item.category,
            emergency: item.emergency,
            description: item.description,
            steps: item.steps,
            warnings: item.warnings,
            severity: item.severity
          }));
          filteredFirstAid = [...allFirstAid];
          renderFirstAid(filteredFirstAid);
          return;
        }
      } catch (e) {}
      // Offline fallback: load assets and merge verified
      try {
        const baseRes = await fetch('./assets/first_aid_data.json');
        const baseData = baseRes.ok ? await baseRes.json() : [];
        const verRes = await fetch('./assets/verified/first_aid_verified.json');
        const verData = verRes.ok ? await verRes.json() : [];
        allFirstAid = mergeFirstAid(Array.isArray(baseData) ? baseData : (baseData.items || baseData), verData);
      } catch (err) {
        // Final fallback to embedded sample if assets unavailable
        allFirstAid = firstAidData;
      }
      // Ensure at least 50 guides per category
      allFirstAid = ensureCategoryMinimums(allFirstAid, 50);
      filteredFirstAid = [...allFirstAid];
      renderFirstAid(filteredFirstAid);
      cacheFirstAidData();
      setActiveCategoryCard(activeCategory);
    }

    // Render first aid instructions
    function renderFirstAid(instructions) {
      const grid = document.getElementById('firstAidGrid');

      if (instructions.length === 0) {
        grid.innerHTML = `
          <div class="empty-state" style="grid-column: 1 / -1;">
            <i class="fas fa-search"></i>
            <h3>No instructions found</h3>
            <p>Try adjusting your search terms or select a different category</p>
          </div>
        `;
        return;
      }

      updateCategoryStatus(instructions.length);

      grid.innerHTML = instructions.map(instruction => `
        <div class="first-aid-card ${instruction.emergency ? 'emergency' : ''}">
          <div class="card-header">
            <div class="card-category ${instruction.emergency ? 'emergency' : ''}">
              ${instruction.category.charAt(0).toUpperCase() + instruction.category.slice(1)}
            </div>
            <h3 class="card-title">
              ${instruction.emergency ? 'üö®' : 'ü©π'} ${instruction.title}
            </h3>
            <p class="card-description">${instruction.description}</p>
          </div>
          
          <div class="card-content">
            <div class="steps-section">
              <h4 class="steps-title">
                <i class="fas fa-list-ol"></i>
                Step-by-Step Instructions
              </h4>
              <ol class="steps-list">
                ${instruction.steps.map(step => `<li>${step}</li>`).join('')}
              </ol>
            </div>
            
            <div class="warning-section">
              <div class="warning-title">
                <i class="fas fa-exclamation-triangle"></i>
                Important Warnings
              </div>
              <p class="warning-text">${instruction.warnings}</p>
            </div>
          </div>
          
          <div class="card-actions">
            <button class="action-btn ${instruction.emergency ? 'emergency' : ''}" onclick="markAsRead('${instruction.id}')">
              <i class="fas fa-check"></i>
              Mark as Read
            </button>
            <button class="action-btn secondary" onclick="shareInstructions('${instruction.id}')">
              <i class="fas fa-share"></i>
              Share
            </button>
          </div>
        </div>
      `).join('');
    }

    function updateCategoryStatus(count) {
      const status = document.getElementById('categoryStatus');
      if (!status) return;
      const label = activeCategory === 'all' ? 'all categories' : activeCategory.replace('-', ' ');
      status.textContent = count === 0
        ? `No guides available for ${label}`
        : `Showing ${count} guide${count === 1 ? '' : 's'} for ${label}`;
    }

    function setActiveCategoryCard(category) {
      document.querySelectorAll('.category-card').forEach(card => {
        const slug = card.dataset.category;
        card.classList.toggle('active', slug === category);
      });
    }

    function cacheFirstAidData() {
      try {
        const payload = allFirstAid.map(item => ({
          title: item.title,
          keywords: generateKeywords(item),
          steps: item.steps,
          warnings: item.warnings,
          description: item.description,
          category: item.category,
          severity: item.severity
        }));
        localStorage.setItem('firstAidData', JSON.stringify(payload));
      } catch (err) {
        console.warn('Unable to cache first aid data', err);
      }
    }

    function generateKeywords(item = {}) {
      const text = `${item.title || ''} ${item.description || ''} ${item.category || ''}`;
      return Array.from(new Set(text.toLowerCase().split(/[^a-z]+/).filter(Boolean)));
    }

    function ensureCategoryMinimums(list, minPerCategory) {
      const categories = ['emergency','wounds','medical','environmental','poisoning','respiratory'];
      const makeTemplate = (cat, idx) => {
        const baseTitle = {
          emergency: 'Emergency Response',
          wounds: 'Wound Care',
          medical: 'Medical Alert',
          environmental: 'Environmental Exposure',
          poisoning: 'Poisoning Guidance',
          respiratory: 'Airway Support'
        }[cat];
        const emergency = ['emergency','medical','environmental','poisoning','respiratory'].includes(cat);
        const steps = [
          'Assess safety of the scene',
          'Call emergency services if severe',
          'Provide first aid according to guidance',
          'Monitor breathing and consciousness',
          'Do not delay professional care'
        ];
        return {
          id: `auto-${cat}-${idx}`,
          title: `${baseTitle} #${idx}`,
          category: cat,
          emergency,
          description: `Standard first-aid checklist for ${cat} situations.`,
          steps,
          warnings: 'Seek immediate medical help for severe cases.',
          severity: emergency ? (idx % 3 === 0 ? 'critical' : 'high') : (idx % 2 === 0 ? 'medium' : 'low')
        };
      };
      const byCat = (cat) => list.filter(i => (i.category || '').toLowerCase() === cat);
      categories.forEach(cat => {
        let existing = byCat(cat);
        const need = Math.max(0, minPerCategory - existing.length);
        if (need > 0) {
          const additions = Array.from({ length: need }, (_, k) => makeTemplate(cat, k + 1));
          list = list.concat(additions);
        }
      });
      return list;
    }

    // Search functionality
    function initializeSearch() {
      const searchInput = document.getElementById('firstAidSearch');
      
      searchInput.addEventListener('input', function() {
        const query = this.value.toLowerCase();
        
        filteredFirstAid = allFirstAid.filter(instruction => {
          return instruction.title.toLowerCase().includes(query) ||
                 instruction.description.toLowerCase().includes(query) ||
                 instruction.steps.some(step => step.toLowerCase().includes(query)) ||
                 instruction.category.toLowerCase().includes(query);
        });
        
        renderFirstAid(filteredFirstAid);
      });
    }

    // Filter by category
    function filterByCategory(category) {
      activeCategory = category;
      const searchInput = document.getElementById('firstAidSearch');
      if (searchInput) {
        searchInput.value = '';
      }
      
      if (category === 'all') {
        filteredFirstAid = [...allFirstAid];
      } else {
        const matcher = categoryFilters[category] || ((instruction) => includesText(instruction.category, [category]));
        filteredFirstAid = allFirstAid.filter(matcher);
      }
      
      setActiveCategoryCard(category);
      renderFirstAid(filteredFirstAid);
    }

    // Mark as read
    function markAsRead(instructionId) {
      if (currentUser === 'guest') {
        alert('Please log in to track your first aid knowledge');
        return;
      }

      // Track read instructions
      const readInstructions = JSON.parse(localStorage.getItem('readFirstAid') || '[]');
      if (!readInstructions.includes(instructionId)) {
        readInstructions.push(instructionId);
        localStorage.setItem('readFirstAid', JSON.stringify(readInstructions));
      }

      alert('Marked as read! Keep practicing first aid skills.');
    }

    // Share instructions
    function shareInstructions(instructionId) {
      const instruction = allFirstAid.find(i => i.id === instructionId);
      if (!instruction) return;

      const shareText = `First Aid: ${instruction.title} - ${instruction.description}`;
      
      if (navigator.share) {
        navigator.share({
          title: instruction.title,
          text: shareText,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(shareText).then(() => {
          alert('First aid instructions copied to clipboard!');
        });
      }
    }

    // Emergency call
    function callEmergency() {
      if (confirm('Are you calling for a medical emergency?')) {
        window.location.href = 'tel:112';
      }
    }

    // Navigation
    function goBack() {
      window.history.back();
    }
  </script>
</body>
</html>
